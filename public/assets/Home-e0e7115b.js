import{Q as T}from"./QCardSection-d26faa53.js";import{Q as B}from"./QDialog-db694845.js";import{Q as I}from"./QBtn-84d97db2.js";import{H as N}from"./HeaderLayout-a6dad372.js";import{F as D}from"./FormAssistance-a979aecc.js";import{Q as y}from"./QInput-f9d1dd50.js";import{d as Q,u as R,r as _,a as O,w as C,o as E,c as $,b as i,e as t,Q as F,f as u,g as V,h as L,A as U,p as q,i as A,_ as h,s as z,j as M,k,l as P}from"./index-daaabc4f.js";import{Q as H,V as v}from"./QForm-953e357b.js";import{u as j}from"./use-key-composition-88659357.js";import{A as J}from"./AssistanceService-05956a1b.js";import"./use-prevent-scroll-f90505a2.js";import"./scroll-f9fbc6b4.js";import"./use-timeout-af311404.js";import"./TouchPan-ab0145b5.js";import"./selection-a01cad79.js";import"./format-7389883c.js";import"./use-tick-b9bb58f2.js";import"./focus-manager-e79c27be.js";import"./QLayout-3fbeca0d.js";import"./QList-bcae5e36.js";import"./QItemLabel-c4ac9f6a.js";import"./QCheckbox-a46065f7.js";import"./QChip-5ca0a42f.js";import"./rtl-36dd996b.js";import"./QOptionGroup-efc4ae94.js";import"./ClosePopup-261f1e7e.js";import"./uid-6a237b22.js";const G=d=>(q("data-v-0f4a5f6e"),d=d(),A(),d),K=G(()=>u("h4",{class:"title"},"Регистрация",-1)),W={class:"buttons"},X={class:"swap"},Y=Q({__name:"FormReg",emits:["swap","submit"],setup(d,{emit:n}){const b=R(),w=_(null),f=_(!1),p=_(!1),m=_(!1),a=O({name:"",login:"",email:"",password:""}),l=O({login:"",email:"",password:""}),c={name:[e=>v.required(e)||"Это обязательное поле"],login:[e=>v.required(e)||"Это обязательное поле"],email:[e=>v.required(e)||"Это обязательное поле",e=>v.isEmail(e)||"Введите корректный е-мэйл"],password:[e=>v.required(e)||"Это обязательное поле",e=>v.lengthInterval(6,20)(e)||"Пароль должен содержать от 6 до 20 символов"]};C(a,async()=>{var e;f.value=await((e=w.value)==null?void 0:e.validate())&&!p.value||!1});async function g(){var e,s,o,S;try{p.value=!0;const r=await U.registration(a);localStorage.setItem("token",r.data.accessToken),b.user=r.data.user,n("submit"),n("swap","log")}catch(r){(s=(e=r==null?void 0:r.response)==null?void 0:e.data)!=null&&s.errors.includes("email")?l.email="Уже занят":(S=(o=r==null?void 0:r.response)==null?void 0:o.data)!=null&&S.errors.includes("login")&&(l.login="Уже занят")}finally{p.value=!1}}return(e,s)=>(E(),$(H,{class:"form",ref_key:"formRef",ref:w,onSubmit:L(g,["prevent"]),"no-error-focus":""},{default:i(()=>[K,t(y,{class:"input",modelValue:a.name,"onUpdate:modelValue":s[0]||(s[0]=o=>a.name=o),outlined:"",label:"Имя",rules:c.name},null,8,["modelValue","rules"]),t(y,{class:"input",modelValue:a.login,"onUpdate:modelValue":s[1]||(s[1]=o=>a.login=o),outlined:"",label:"Логин",rules:c.login,error:!!l.login,"error-message":l.login},null,8,["modelValue","rules","error","error-message"]),t(y,{class:"input",modelValue:a.email,"onUpdate:modelValue":s[2]||(s[2]=o=>a.email=o),outlined:"",label:"Адрес электронной почты",rules:c.email,error:!!l.email,"error-message":l.email},{append:i(()=>[t(F,{name:"email"})]),_:1},8,["modelValue","rules","error","error-message"]),t(y,{class:"input",modelValue:a.password,"onUpdate:modelValue":s[4]||(s[4]=o=>a.password=o),outlined:"",label:"Пароль",rules:c.password,type:m.value?"text":"password"},{append:i(()=>[t(F,{name:m.value?"visibility":"visibility_off",onClick:s[3]||(s[3]=o=>m.value=!m.value)},null,8,["name"])]),_:1},8,["modelValue","rules","type"]),u("div",W,[t(I,{type:"submit",color:"primary",loading:p.value,disable:!f.value},{default:i(()=>[V("Регистрация")]),_:1},8,["loading","disable"])]),u("div",X,[V("Уже зарегестрировны? "),u("span",{onClick:s[5]||(s[5]=o=>n("swap","log"))},"Вход")])]),_:1},8,["onSubmit"]))}});const Z=h(Y,[["__scopeId","data-v-0f4a5f6e"]]),ee=d=>(q("data-v-4be8e458"),d=d(),A(),d),se=ee(()=>u("h4",{class:"title"},"Вход",-1)),oe={class:"buttons"},ae={class:"swap"},re={class:"swap"},le=Q({__name:"FormLog",emits:["swap","submit"],setup(d,{emit:n}){const b=R(),w=_(null),f=_(!1),p=_(!1),m=_(!1),a=O({loginOrEmail:"",password:""}),l=O({loginOrEmail:"",password:""}),c={loginOrEmail:[e=>v.required(e)||"Это обязательное поле"],password:[e=>v.required(e)||"Это обязательное поле"]};C(a,async()=>{var e;p.value=await((e=w.value)==null?void 0:e.validate())&&!f.value||!1});async function g(){var e,s,o,S;try{f.value=!0;const r=await U.login(a.loginOrEmail,a.password);localStorage.setItem("token",r.data.accessToken),b.user=r.data.user,n("submit")}catch(r){(s=(e=r==null?void 0:r.response)==null?void 0:e.data)!=null&&s.errors.includes("email")?l.loginOrEmail="Неверный логин или е-мэйл":(S=(o=r==null?void 0:r.response)==null?void 0:o.data)!=null&&S.errors.includes("password")&&(l.password="Неверный пароль")}finally{f.value=!1}}return(e,s)=>(E(),$(H,{class:"form",onSubmit:L(g,["prevent"]),ref_key:"formRef",ref:w,"no-error-focus":""},{default:i(()=>[se,t(y,{class:"input",modelValue:a.loginOrEmail,"onUpdate:modelValue":s[0]||(s[0]=o=>a.loginOrEmail=o),outlined:"",label:"Логин или е-мэйл",rules:c.loginOrEmail,error:!!l.loginOrEmail,"error-message":l.loginOrEmail,"lazy-rules":""},null,8,["modelValue","rules","error","error-message"]),t(y,{class:"input",modelValue:a.password,"onUpdate:modelValue":s[2]||(s[2]=o=>a.password=o),outlined:"",label:"Пароль",rules:c.password,error:!!l.password,"error-message":l.password,"lazy-rules":"",type:m.value?"text":"password"},{append:i(()=>[t(F,{name:m.value?"visibility":"visibility_off",onClick:s[1]||(s[1]=o=>m.value=!m.value)},null,8,["name"])]),_:1},8,["modelValue","rules","error","error-message","type"]),u("div",oe,[t(I,{type:"submit",color:"primary",loading:f.value,disable:!p.value},{default:i(()=>[V("Войти")]),_:1},8,["loading","disable"])]),u("div",ae,[V("Еще не зарегестрировны? "),u("span",{onClick:s[3]||(s[3]=o=>n("swap","reg"))},"Регистрация")]),u("div",re,[V("Забыли пароль? "),u("span",{onClick:s[4]||(s[4]=o=>e.$router.push("/restore"))},"Восстановить")])]),_:1},8,["onSubmit"]))}});const x=h(le,[["__scopeId","data-v-4be8e458"]]),te={class:"container"},ie=Q({__name:"Home",setup(d){const n=_(!1),b=z(x),w=O({name:"",surname:"",patronymic:"",phone:"",birth:"",district:"",street:"",house:"",flat:"",people_num:"",people_fio:[],invalids:"Нет",kids:"Нет",kids_age:[],food:"Нет",water:"Нет",medicines:"Нет",medicines_info:"",hygiene:"Нет",hygiene_info:"",pampers:"Нет",pampers_info:"",diet:"",pers_data_agreement:!1,photo_agreement:!1}),{tg:f,isOpenedFromTg:p}=M(),{f:m,loading:a}=j({fn:g=>J.sendForm(g).then(()=>{p&&f.sendData(JSON.stringify("Сохранено"))}),alert:!0,successMsg:"Сохранено"});function l(){n.value=!n.value}function c(g){switch(g){case"log":b.value=x;break;case"reg":b.value=Z;break}}return(g,e)=>(E(),$(N,{onOpenLogin:l,"open-from-tg":k(p)},{form:i(()=>[t(B,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value=s)},{default:i(()=>[t(T,null,{default:i(()=>[(E(),$(P(k(b)),{onSwap:c,onSubmit:l},null,32))]),_:1})]),_:1},8,["modelValue"])]),default:i(()=>[u("div",te,[t(D,{form:w,title:"Заявка на получение гуманитарной помощи",onSubmit:k(m),loading:k(a),reset:""},{submit:i(({type:s,valid:o})=>[t(I,{type:s,loading:k(a),disable:!o,color:"primary"},{default:i(()=>[V("Отправить")]),_:2},1032,["type","loading","disable"])]),_:1},8,["form","onSubmit","loading"])])]),_:1},8,["open-from-tg"]))}});const Ue=h(ie,[["__scopeId","data-v-0faa46ff"]]);export{Ue as default};
