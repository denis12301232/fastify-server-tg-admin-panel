import{u as Je,a as Ke,Q as $e}from"./QDialog-fb7ab497.js";import{Q as R,R as O,p as Ze,m as et,n as tt,a as at}from"./QBtn-c600b51e.js";import{Q as lt,c as nt,b as rt,a as st,d as ot,e as ye,f as ut}from"./QLayout-7e677f3e.js";import{c as it,Q as oe,b as Y,a as ct}from"./QCardSection-80a7d0cd.js";import{r as C,d as P,o as _,c as S,b as t,g as $,a2 as I,a3 as q,k as o,a4 as de,a1 as V,a0 as A,_ as G,u as K,e as a,f as Q,E as U,Q as B,a5 as dt,aG as ee,n as x,aH as H,ax as we,w as j,aa as X,a9 as Z,m as ue,q as y,ac as vt,ae as mt,af as _t,D as ft,X as ht,v as Ie,B as Le,aI as qe,p as ve,i as me,O as gt,l as Te,s as pt}from"./index-9de4a442.js";import{Q as T,a as z}from"./selection-8de44bdc.js";import{Q as W}from"./QList-2e435860.js";import{Q as te}from"./QInput-dc0f1e6f.js";import{b as D,Q as Qe}from"./QItemLabel-9267f3e9.js";import{u as N,a as Ve,b as De}from"./use-key-composition-20c01320.js";import{T as Ce}from"./TouchPan-de830ece.js";import{b as re}from"./format-7389883c.js";import{e as ie,s as Se}from"./scroll-481bd017.js";import{C as se}from"./ClosePopup-37448b23.js";import{Q as bt}from"./QLinearProgress-fb95009b.js";import{Q as Ue}from"./QCardActions-dbcc5faa.js";import"./use-prevent-scroll-9bdff198.js";import"./use-timeout-3c025720.js";import"./use-tick-b7ad69f5.js";import"./focus-manager-e79c27be.js";import"./uid-6a237b22.js";class _e{static convertDay(n){return n<10?`0${n}`:n}static convertMonth(n){return n+1<10?`0${n+1}`:n+1}static convertYear(n){return n}static convertHours(n){return n<10?`0${n}`:n}static convertMinutes(n){return n<10?`0${n}`:n}static timeStruct(n){return{year:n.getFullYear(),month:n.getMonth(),day:n.getDate(),hours:n.getHours(),minutes:n.getMinutes()}}static showFilteredDate(n){const s=new Date,r=this.timeStruct(s),m=this.timeStruct(n);return r.year===m.year&&r.month===m.month&&r.day===m.day?`${this.convertHours(m.hours)}:${this.convertMinutes(m.minutes)}`:r.year===m.year?`${this.convertDay(m.day)}.${this.convertMonth(m.month)}`:`${this.convertDay(m.day)}.${this.convertMonth(m.month)}.${this.convertYear(m.year)}`}}function yt(){const e=C(null),n=C(null),s=C(null),r=C(!1);async function m(){e.value=await navigator.mediaDevices.getUserMedia({audio:!0}),n.value=new MediaRecorder(e.value,{audioBitsPerSecond:128e3}),n.value.onstart=()=>r.value=!r.value,n.value.onstop=()=>r.value=!r.value,n.value.ondataavailable=i=>{s.value=new File([i.data],"audio.ogg")},n.value.start()}function h(){var i,l,p;(i=n.value)==null||i.stop(),s.value=null,(p=(l=e.value)==null?void 0:l.getTracks().at(0))==null||p.stop()}return{mediaRecorder:n,isRecording:r,voiceMessage:s,startRecording:m,stopRecording:h}}const Ct=["src"],St=P({__name:"UserAvatar",props:{avatar:null,name:null,size:{default:"45px"},color:{default:"secondary"}},setup(e){return(n,s)=>(_(),S(it,{class:A(n.$style.avatar),size:e.size,color:e.color},{default:t(()=>[$(I(e.avatar?"":e.name.slice(0,1)),1),e.avatar?(_(),q("img",{key:0,src:`${o(de).SERVER_URL}/avatars/${e.avatar}`},null,8,Ct)):V("",!0)]),_:1},8,["class","size","color"]))}}),zt="_avatar_1dacu_1",kt={avatar:zt},xt={$style:kt},J=G(St,[["__cssModules",xt]]),Mt={class:"user_name"},$t={class:"user_status"},wt=P({__name:"ChatLayout",emits:["openCreateGroup"],setup(e,{emit:n}){const s=K(),r=C(!1);function m(){r.value=!r.value}return(h,i)=>(_(),S(lt,{class:A(o(s).currentTheme==="dark"?"dark":"light"),view:"hHh lpR fFf"},{default:t(()=>[a(st,{class:"header",bordered:""},{default:t(()=>[a(nt,null,{default:t(()=>[a(R,{icon:"menu",dense:"",flat:"",round:"",onClick:m}),a(rt,null,{default:t(()=>[$("Мессенджер")]),_:1})]),_:1})]),_:1}),a(ct,{modelValue:r.value,"onUpdate:modelValue":i[1]||(i[1]=l=>r.value=l),side:"left",overlay:"",bordered:""},{default:t(()=>[a(W,{class:"list"},{default:t(()=>[a(oe,{class:"user_info",flat:"",square:""},{default:t(()=>[a(Y,null,{default:t(()=>[a(J,{name:o(s).user.name,avatar:o(s).user.avatar},null,8,["name","avatar"]),Q("div",Mt,I(o(s).user.name),1),Q("div",$t,I(o(s).user.status),1)]),_:1})]),_:1}),U((_(),S(T,{class:"list_item",clickable:"",tag:"a",to:"/","active-class":"active"},{default:t(()=>[a(z,{avatar:""},{default:t(()=>[a(B,{name:"home"})]),_:1}),a(z,null,{default:t(()=>[$("На главную")]),_:1})]),_:1})),[[O]]),U((_(),S(T,{class:"list_item",clickable:"",tag:"a",to:"/account","active-class":"active"},{default:t(()=>[a(z,{avatar:""},{default:t(()=>[a(B,{name:"account_circle"})]),_:1}),a(z,null,{default:t(()=>[$("Аккаунт")]),_:1})]),_:1})),[[O]]),U((_(),S(T,{class:"list_item",clickable:"","active-class":"active",onClick:i[0]||(i[0]=l=>[n("openCreateGroup"),m()])},{default:t(()=>[a(z,{avatar:""},{default:t(()=>[a(B,{name:"note_add"})]),_:1}),a(z,null,{default:t(()=>[$("Создать группу")]),_:1})]),_:1})),[[O]])]),_:1})]),_:1},8,["modelValue"]),a(ot,{style:{height:"100vh"}},{default:t(()=>[dt(h.$slots,"default",{},void 0,!0)]),_:3})]),_:3},8,["class"]))}});const It=G(wt,[["__scopeId","data-v-3340b5b0"]]),Lt={class:"chats"},qt={key:0,class:"text-center"},Tt={key:0,class:"text-center"},Qt={style:{display:"flex","align-items":"center"}},Vt={key:0,class:"unread_count"},Dt=P({__name:"MessangerChatsList",props:{currentChatId:null,chats:null},setup(e){const n=K(),s=ee(),r=C(""),m=x(()=>s.chatsList.reduce((f,g)=>[...f,new Date(g.updatedAt)],[])),{f:h,data:i,loading:l}=N({fn:H.findUsers}),p=we.throttleDecorator(h,1e3);j(r,(f,g)=>{f?p(r.value):i.value=[]});async function M(f){const g=await H.createChat([n.user._id,f]),c=s.chatsList.find(u=>u._id===g.data._id);c?(s.currentChatId=c._id,s.onOpenChat(c._id)):(s.currentChatId=g.data._id,s.chatsList.push(g.data)),r.value=""}return(f,g)=>(_(),q("div",Lt,[a(te,{modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=c=>r.value=c),label:"Поиск",outlined:"",dense:"",clearable:""},null,8,["modelValue"]),r.value?(_(),S(W,{key:0,class:"chats_list"},{default:t(()=>{var c;return[(c=o(i))!=null&&c.length?V("",!0):(_(),q("h6",qt,"Ничего не найдено")),(_(!0),q(X,null,Z(o(i),u=>U((_(),S(T,{clickable:"",onClick:v=>M(u._id)},{default:t(()=>[a(z,{avatar:""},{default:t(()=>[a(J,{name:u.name,avatar:u.avatar},null,8,["name","avatar"])]),_:2},1024),a(z,null,{default:t(()=>[$(I(u.name),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[O]])),256))]}),_:1})):(_(),S(W,{key:1,class:"chats_list"},{default:t(()=>{var c;return[(c=e.chats)!=null&&c.length?V("",!0):(_(),q("h6",Tt,"Список диалогов пуст")),(_(!0),q(X,null,Z(e.chats,(u,v)=>U((_(),S(T,{class:"list_item",clickable:"","active-class":o(n).currentTheme==="dark"?"active_dark":"active_light",active:e.currentChatId===u._id,onClick:k=>o(s).onOpenChat(u._id)},{default:t(()=>[a(z,{avatar:""},{default:t(()=>{var k,L;return[a(J,{name:u.type==="dialog"?u.companion.name:((k=u.group)==null?void 0:k.title)||"",avatar:u.type==="dialog"?u.companion.avatar:((L=u.group)==null?void 0:L.avatar)||""},null,8,["name","avatar"])]}),_:2},1024),a(z,null,{default:t(()=>[a(D,null,{default:t(()=>{var k;return[$(I(u.type==="dialog"?u.companion.name:(k=u.group)==null?void 0:k.title),1)]}),_:2},1024),a(D,{caption:"",lines:"2"},{default:t(()=>{var k,L;return[$(I(u.messages.length?((L=(k=u==null?void 0:u.messages)==null?void 0:k.at(-1))==null?void 0:L.text)||"Аудиосообщение":"Еще нет сообщений"),1)]}),_:2},1024)]),_:2},1024),a(z,{side:"",top:"",bottom:""},{default:t(()=>[a(D,{caption:""},{default:t(()=>{var k,L,F;return[Q("div",Qt,[u.type==="dialog"&&((L=(k=u.messages)==null?void 0:k.at(-1))==null?void 0:L.author)===o(n).user._id?(_(),S(B,{key:0,name:(F=u.messages.at(-1))!=null&&F.read.includes(u.companion._id)?"mdi-check-all":"mdi-check",style:{"padding-right":"5px"}},null,8,["name"])):V("",!0),Q("div",null,I(`${o(_e).showFilteredDate(o(m)[v])}`),1)]),+u.unread?(_(),q("div",Vt,[Q("span",null,I(u.unread),1)])):V("",!0)]}),_:2},1024)]),_:2},1024)]),_:2},1032,["active-class","active","onClick"])),[[O]])),256))]}),_:1}))]))}});const Ut=G(Dt,[["__scopeId","data-v-da21eddc"]]),Ae=ue({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(e,{slots:n}){const s=x(()=>e.sent===!0?"sent":"received"),r=x(()=>`q-message-text-content q-message-text-content--${s.value}`+(e.textColor!==void 0?` text-${e.textColor}`:"")),m=x(()=>`q-message-text q-message-text--${s.value}`+(e.bgColor!==void 0?` text-${e.bgColor}`:"")),h=x(()=>"q-message-container row items-end no-wrap"+(e.sent===!0?" reverse":"")),i=x(()=>e.size!==void 0?`col-${e.size}`:""),l=x(()=>({msg:e.textHtml===!0?"innerHTML":"textContent",stamp:e.stampHtml===!0?"innerHTML":"textContent",name:e.nameHtml===!0?"innerHTML":"textContent",label:e.labelHtml===!0?"innerHTML":"textContent"}));function p(f){return n.stamp!==void 0?[f,y("div",{class:"q-message-stamp"},n.stamp())]:e.stamp?[f,y("div",{class:"q-message-stamp",[l.value.stamp]:e.stamp})]:[f]}function M(f,g){const c=g===!0?f.length>1?u=>u:u=>y("div",[u]):u=>y("div",{[l.value.msg]:u});return f.map((u,v)=>y("div",{key:v,class:m.value},[y("div",{class:r.value},p(c(u)))]))}return()=>{const f=[];n.avatar!==void 0?f.push(n.avatar()):e.avatar!==void 0&&f.push(y("img",{class:`q-message-avatar q-message-avatar--${s.value}`,src:e.avatar,"aria-hidden":"true"}));const g=[];n.name!==void 0?g.push(y("div",{class:`q-message-name q-message-name--${s.value}`},n.name())):e.name!==void 0&&g.push(y("div",{class:`q-message-name q-message-name--${s.value}`,[l.value.name]:e.name})),n.default!==void 0?g.push(M(Ze(n.default()),!0)):e.text!==void 0&&g.push(M(e.text)),f.push(y("div",{class:i.value},g));const c=[];return n.label!==void 0?c.push(y("div",{class:"q-message-label"},n.label())):e.label!==void 0&&c.push(y("div",{class:"q-message-label",[l.value.label]:e.label})),c.push(y("div",{class:h.value},f)),y("div",{class:`q-message q-message-${s.value}`},c)}}}),ze=["vertical","horizontal"],ce={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},ke={prevent:!0,mouse:!0,mouseAllDir:!0},xe=e=>e>=250?50:Math.ceil(e/5),Re=ue({name:"QScrollArea",props:{...Ve,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:n,emit:s}){const r=C(!1),m=C(!1),h=C(!1),i={vertical:C(0),horizontal:C(0)},l={vertical:{ref:C(null),position:C(0),size:C(0)},horizontal:{ref:C(null),position:C(0),size:C(0)}},{proxy:p}=Ie(),M=De(e,p.$q);let f=null,g;const c=C(null),u=x(()=>"q-scrollarea"+(M.value===!0?" q-scrollarea--dark":""));l.vertical.percentage=x(()=>{const d=l.vertical.size.value-i.vertical.value;if(d<=0)return 0;const b=re(l.vertical.position.value/d,0,1);return Math.round(b*1e4)/1e4}),l.vertical.thumbHidden=x(()=>(e.visible===null?h.value:e.visible)!==!0&&r.value===!1&&m.value===!1||l.vertical.size.value<=i.vertical.value+1),l.vertical.thumbStart=x(()=>l.vertical.percentage.value*(i.vertical.value-l.vertical.thumbSize.value)),l.vertical.thumbSize=x(()=>Math.round(re(i.vertical.value*i.vertical.value/l.vertical.size.value,xe(i.vertical.value),i.vertical.value))),l.vertical.style=x(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${l.vertical.thumbStart.value}px`,height:`${l.vertical.thumbSize.value}px`})),l.vertical.thumbClass=x(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(l.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),l.vertical.barClass=x(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(l.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),l.horizontal.percentage=x(()=>{const d=l.horizontal.size.value-i.horizontal.value;if(d<=0)return 0;const b=re(Math.abs(l.horizontal.position.value)/d,0,1);return Math.round(b*1e4)/1e4}),l.horizontal.thumbHidden=x(()=>(e.visible===null?h.value:e.visible)!==!0&&r.value===!1&&m.value===!1||l.horizontal.size.value<=i.horizontal.value+1),l.horizontal.thumbStart=x(()=>l.horizontal.percentage.value*(i.horizontal.value-l.horizontal.thumbSize.value)),l.horizontal.thumbSize=x(()=>Math.round(re(i.horizontal.value*i.horizontal.value/l.horizontal.size.value,xe(i.horizontal.value),i.horizontal.value))),l.horizontal.style=x(()=>({...e.thumbStyle,...e.horizontalThumbStyle,[p.$q.lang.rtl===!0?"right":"left"]:`${l.horizontal.thumbStart.value}px`,width:`${l.horizontal.thumbSize.value}px`})),l.horizontal.thumbClass=x(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(l.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),l.horizontal.barClass=x(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(l.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const v=x(()=>l.vertical.thumbHidden.value===!0&&l.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),k=[[Ce,d=>{ge(d,"vertical")},void 0,{vertical:!0,...ke}]],L=[[Ce,d=>{ge(d,"horizontal")},void 0,{horizontal:!0,...ke}]];function F(){const d={};return ze.forEach(b=>{const w=l[b];d[b+"Position"]=w.position.value,d[b+"Percentage"]=w.percentage.value,d[b+"Size"]=w.size.value,d[b+"ContainerSize"]=i[b].value}),d}const fe=vt(()=>{const d=F();d.ref=p,s("scroll",d)},0);function he(d,b,w){if(ze.includes(d)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(d==="vertical"?Se:ie)(c.value,b,w)}function Ge({height:d,width:b}){let w=!1;i.vertical.value!==d&&(i.vertical.value=d,w=!0),i.horizontal.value!==b&&(i.horizontal.value=b,w=!0),w===!0&&ae()}function Fe({position:d}){let b=!1;l.vertical.position.value!==d.top&&(l.vertical.position.value=d.top,b=!0),l.horizontal.position.value!==d.left&&(l.horizontal.position.value=d.left,b=!0),b===!0&&ae()}function Be({height:d,width:b}){l.horizontal.size.value!==b&&(l.horizontal.size.value=b,ae()),l.vertical.size.value!==d&&(l.vertical.size.value=d,ae())}function ge(d,b){const w=l[b];if(d.isFirst===!0){if(w.thumbHidden.value===!0)return;g=w.position.value,m.value=!0}else if(m.value!==!0)return;d.isFinal===!0&&(m.value=!1);const E=ce[b],ne=i[b].value,Ye=(w.size.value-ne)/(ne-w.thumbSize.value),Xe=d.distance[E.dist],We=g+(d.direction===E.dir?1:-1)*Xe*Ye;be(We,b)}function pe(d,b){const w=l[b];if(w.thumbHidden.value!==!0){const E=d[ce[b].offset];if(E<w.thumbStart.value||E>w.thumbStart.value+w.thumbSize.value){const ne=E-w.thumbSize.value/2;be(ne/i[b].value*w.size.value,b)}w.ref.value!==null&&w.ref.value.dispatchEvent(new MouseEvent(d.type,d))}}function Oe(d){pe(d,"vertical")}function je(d){pe(d,"horizontal")}function ae(){r.value=!0,f!==null&&clearTimeout(f),f=setTimeout(()=>{f=null,r.value=!1},e.delay),e.onScroll!==void 0&&fe()}function be(d,b){c.value[ce[b].scroll]=d}function Ne(){h.value=!0}function Ee(){h.value=!1}let le=null;return j(()=>p.$q.lang.rtl,d=>{c.value!==null&&ie(c.value,Math.abs(l.horizontal.position.value)*(d===!0?-1:1))}),mt(()=>{le={top:l.vertical.position.value,left:l.horizontal.position.value}}),_t(()=>{if(le===null)return;const d=c.value;d!==null&&(ie(d,le.left),Se(d,le.top))}),ft(fe.cancel),Object.assign(p,{getScrollTarget:()=>c.value,getScroll:F,getScrollPosition:()=>({top:l.vertical.position.value,left:l.horizontal.position.value}),getScrollPercentage:()=>({top:l.vertical.percentage.value,left:l.horizontal.percentage.value}),setScrollPosition:he,setScrollPercentage(d,b,w){he(d,b*(l[d].size.value-i[d].value)*(d==="horizontal"&&p.$q.lang.rtl===!0?-1:1),w)}}),()=>y("div",{class:u.value,onMouseenter:Ne,onMouseleave:Ee},[y("div",{ref:c,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[y("div",{class:"q-scrollarea__content absolute",style:v.value},ht(n.default,[y(ye,{debounce:0,onResize:Be})])),y(ut,{axis:"both",onScroll:Fe})]),y(ye,{debounce:0,onResize:Ge}),y("div",{class:l.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:Oe}),y("div",{class:l.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:je}),U(y("div",{ref:l.vertical.ref,class:l.vertical.thumbClass.value,style:l.vertical.style.value,"aria-hidden":"true"}),k),U(y("div",{ref:l.horizontal.ref,class:l.horizontal.thumbClass.value,style:l.horizontal.style.value,"aria-hidden":"true"}),L)])}}),At={key:0},Rt={key:1,class:"recording"},Ht=P({__name:"MessangerInput",setup(e){const n=ee(),s=C(""),r=C(null),{voiceMessage:m,isRecording:h,startRecording:i,stopRecording:l}=yt(),{f:p,data:M,loading:f}=N({fn:()=>H.saveMessage(n.currentChatId,s.value)}),{f:g,data:c,loading:u}=N({fn:()=>H.saveAudioMessage(r.value,n.currentChatId)});return j(m,()=>{m.value&&(r.value=new FormData,r.value.append("audio",m.value))}),j([M,c],(v,k)=>{v[0]&&v[0]!==k[0]&&(n.currentChat.messages.push(v[0]),n.currentChat.updatedAt=v[0].createdAt,s.value=""),v[1]&&v[1]!==k[1]&&(n.currentChat.messages.push(v[1]),n.currentChat.updatedAt=v[1].createdAt,r.value=null)}),(v,k)=>(_(),S(te,{class:"input",modelValue:s.value,"onUpdate:modelValue":k[2]||(k[2]=L=>s.value=L),outlined:"","label-slot":"",loading:o(f)||o(u),readonly:o(h)},{label:t(()=>[o(h)?(_(),q("div",Rt,"Идет запись... ")):(_(),q("div",At,"Написать сообщение"))]),append:t(()=>[a(R,{dense:"",round:"",flat:"",icon:o(h)?"mic_off":"mic",onClick:k[0]||(k[0]=L=>o(h)?o(l)():o(i)())},null,8,["icon"]),a(R,{dense:"",round:"",flat:"",icon:"send",disable:o(f)||o(u),onClick:k[1]||(k[1]=L=>r.value?o(g)():o(p)())},null,8,["disable"])]),_:1},8,["modelValue","loading","readonly"]))}});const He=G(Ht,[["__scopeId","data-v-cf1d9256"]]),Pt=["src"],Gt=P({__name:"MessangerVoiceMessage",props:{src:null},setup(e){const n=C(null),s=C(!1),r=C(0),m=C(0),h=C(0);Le(()=>{n.value&&(n.value.onplay=()=>s.value=!0,n.value.onpause=()=>s.value=!1,n.value.ontimeupdate=l=>{const p=l.target;h.value=(p.duration/100).toFixed(2).replace(".",":"),m.value=(p.currentTime/100).toFixed(2).replace(".",":"),r.value=Math.round(p.currentTime*100/p.duration)/100},n.value.onended=()=>r.value=0)});function i(){var l,p;s.value?(l=n.value)==null||l.pause():(p=n.value)==null||p.play()}return(l,p)=>(_(),q(X,null,[Q("audio",{ref_key:"audio",ref:n,src:e.src,preload:"metadata",volume:1},null,8,Pt),Q("div",{class:A(l.$style.audio)},[a(B,{name:s.value?"stop_circle":"play_circle",onClick:i,size:"40px",color:"white"},null,8,["name"]),Q("div",{class:A(l.$style.audio_info)},[a(bt,{value:r.value,"instant-feedback":"",color:"pink",class:A(l.$style.audio_progress)},null,8,["value","class"]),m.value&&h.value?(_(),q("div",{key:0,class:A(l.$style.audio_time)},I(m.value+" / "+h.value),3)):V("",!0)],2)],2)],64))}}),Ft="_audio_16ywe_1",Bt="_audio_info_16ywe_9",Ot="_audio_time_16ywe_12",jt="_audio_progress_16ywe_16",Nt={audio:Ft,audio_info:Bt,audio_time:Ot,audio_progress:jt},Et={$style:Nt},Pe=G(Gt,[["__cssModules",Et]]),Yt={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Xt={style:{padding:"0 10px 0 0"}},Wt=P({__name:"MessangerDialog",props:{currentChatId:null,currentChat:null},setup(e){const n=e,s=K(),r=ee(),m=C(null),h=x(()=>n.currentChat.messages),i=x(()=>h.value.reduce((p,M)=>[...p,new Date(M.createdAt)],[]));j(h,()=>{setTimeout(()=>{var M,f;const p=(M=m.value)==null?void 0:M.getScroll();(f=m.value)==null||f.setScrollPosition("vertical",(p==null?void 0:p.verticalSize)||0)},0)},{deep:!0,immediate:!0});async function l(){await H.deleteChat(n.currentChatId),r.chatsList=r.chatsList.filter(p=>p._id!==n.currentChatId),r.currentChatId=""}return(p,M)=>(_(),q("div",{class:A(["dialog",o(s).currentTheme==="dark"?"dialog_dark":"dialog_light"])},[a(T,{class:"dialog_name"},{default:t(()=>[a(z,{class:"back",avatar:""},{default:t(()=>[a(R,{dense:"",round:"",flat:"",icon:"arrow_back",color:"primary",onClick:M[0]||(M[0]=f=>o(r).currentChatId="")})]),_:1}),a(z,null,{default:t(()=>[a(D,{class:"text-h6"},{default:t(()=>[$(I(e.currentChat.companion.name),1)]),_:1}),a(D,{caption:""},{default:t(()=>[$(I(e.currentChat.companion.status),1)]),_:1})]),_:1}),a(z,{side:""},{default:t(()=>[a(R,{icon:"more_vert",round:"",dense:"",flat:"",color:"primary"},{default:t(()=>[a(Qe,null,{default:t(()=>[a(W,{bordered:""},{default:t(()=>[U((_(),S(T,{class:"text-red",clickable:"",onClick:l},{default:t(()=>[a(z,{avatar:"",style:{"padding-right":"10px","min-width":"0"}},{default:t(()=>[a(B,{name:"delete"})]),_:1}),a(z,null,{default:t(()=>[$("Удалить чат")]),_:1})]),_:1})),[[O],[se]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Re,{class:"dialog_content",delay:"1200",ref_key:"dialogRef",ref:m},{default:t(()=>[(_(!0),q(X,null,Z(o(h),(f,g)=>{var c;return _(),S(Ae,{text:[f.text],sent:f.author===o(s).user._id,key:f._id,style:{padding:"0 20px"},"bg-color":f.author===o(s).user._id?"primary":"teal","text-color":"white"},qe({stamp:t(()=>[Q("div",Yt,[Q("div",Xt,I(o(_e).showFilteredDate(o(i)[g])),1),f.author===o(s).user._id?(_(),S(B,{key:0,name:f.read.includes(e.currentChat.companion._id)?"mdi-check-all":"mdi-check"},null,8,["name"])):V("",!0)])]),_:2},[((c=f.attachments.at(0))==null?void 0:c.type)==="audio"?{name:"default",fn:t(()=>{var u;return[a(Pe,{src:`${o(de).SERVER_URL}/audio/${(u=f.attachments.at(0))==null?void 0:u.name}`},null,8,["src"])]}),key:"0"}:void 0]),1032,["text","sent","bg-color"])}),128))]),_:1},512),e.currentChatId?(_(),S(He,{key:0,style:{margin:"5px"}})):V("",!0)],2))}});const Me=G(Wt,[["__scopeId","data-v-0e3a8c22"]]),Jt=e=>(ve("data-v-4b1506dd"),e=e(),me(),e),Kt=Jt(()=>Q("div",{class:"title text-h6 text-center"},"Добавить в группу",-1)),Zt={key:0,class:"text-center"},ea=P({__name:"MessangerGroupAddUser",props:{chat_id:null},setup(e){const n=e,s=C(""),r=C(null),{f:m,data:h,loading:i}=N({fn:H.findUsers}),l=we.throttleDecorator(m,1e3),{f:p,loading:M}=N({fn:()=>{var g;return H.addUserToGroup(n.chat_id,(g=r.value)==null?void 0:g._id)},successMsg:"Пользователь добавлен в чат",alert:!0});j(s,(g,c)=>{g?(l(s.value),r.value=null):h.value=[]});function f(g){r.value=g,s.value=""}return(g,c)=>(_(),S(oe,{class:"add"},{default:t(()=>[a(Y,null,{default:t(()=>[Kt,a(te,{modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=u=>s.value=u),outlined:"",loading:o(i),label:"Имя или логин",clearable:""},null,8,["modelValue","loading"])]),_:1}),a(Y,{style:{padding:"0"}},{default:t(()=>{var u;return[a(W,null,{default:t(()=>[r.value?(_(),S(T,{key:1,"active-class":"active",active:!!r.value,clickable:"",onClick:c[1]||(c[1]=v=>r.value=null)},{default:t(()=>[a(z,{avatar:""},{default:t(()=>[a(J,{name:r.value.name,avatar:r.value.avatar},null,8,["name","avatar"])]),_:1}),a(z,{side:""},{default:t(()=>[a(D,null,{default:t(()=>[$(I(r.value.name),1)]),_:1}),a(D,null,{default:t(()=>[$(I(r.value.login),1)]),_:1})]),_:1})]),_:1},8,["active"])):(_(!0),q(X,{key:0},Z(o(h),v=>U((_(),S(T,{clickable:"",onClick:k=>f(v)},{default:t(()=>[a(z,{avatar:""},{default:t(()=>[a(J,{name:v.name,avatar:v.avatar},null,8,["name","avatar"])]),_:2},1024),a(z,{side:""},{default:t(()=>[a(D,null,{default:t(()=>[$(I(v.name),1)]),_:2},1024),a(D,null,{default:t(()=>[$(I(v.login),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[O]])),256))]),_:1}),!((u=o(h))!=null&&u.length)&&s.value?(_(),q("div",Zt,"Не найдено ни одного человека")):V("",!0)]}),_:1}),a(Ue,{align:"center"},{default:t(()=>[U((_(),S(R,{color:"primary",disable:!r.value,loading:o(M),onClick:o(p)},{default:t(()=>[$("Добавить")]),_:1},8,["disable","loading","onClick"])),[[se]])]),_:1})]),_:1}))}});const ta=G(ea,[["__scopeId","data-v-4b1506dd"]]),aa=[y("g",{transform:"translate(-20,-20)"},[y("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[y("animateTransform",{attributeName:"transform",type:"rotate",from:"90 50 50",to:"0 50 50",dur:"1s",repeatCount:"indefinite"})])]),y("g",{transform:"translate(20,20) rotate(15 50 50)"},[y("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[y("animateTransform",{attributeName:"transform",type:"rotate",from:"0 50 50",to:"90 50 50",dur:"1s",repeatCount:"indefinite"})])])],la=ue({name:"QSpinnerGears",props:et,setup(e){const{cSize:n,classes:s}=tt(e);return()=>y("svg",{class:s.value,width:n.value,height:n.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"},aa)}}),na=ue({name:"QInnerLoading",props:{...Ve,...Je,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:n}){const s=Ie(),r=De(e,s.proxy.$q),{transitionProps:m,transitionStyle:h}=Ke(e),i=x(()=>"q-inner-loading absolute-full column flex-center"+(r.value===!0?" q-inner-loading--dark":"")),l=x(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function p(){const f=[y(at,{size:e.size,color:e.color})];return e.label!==void 0&&f.push(y("div",{class:l.value,style:e.labelStyle},[e.label])),f}function M(){return e.showing===!0?y("div",{class:i.value,style:h.value},n.default!==void 0?n.default():p()):null}return()=>y(gt,m.value,M)}}),ra=e=>(ve("data-v-2001a1c3"),e=e(),me(),e),sa=ra(()=>Q("div",{class:"title text-h5 text-center"},"Информация о группе",-1)),oa=P({__name:"MessangerGroupInfo",props:{avatar:null,name:null,chat_id:null,users_count:null,roles:null},setup(e){const n=e,s=K(),r=C(""),{f:m,loading:h,data:i}=N({fn:H.getUsersListInChat}),{f:l,loading:p}=N({fn:g=>{var c;H.removeUserFromGroup(n.chat_id,g),i.value=(c=i.value)==null?void 0:c.filter(u=>u._id!==g)}}),M=x(()=>{var g;return(g=i.value)==null?void 0:g.filter(c=>c.name.includes(r.value)||c.login.includes(r.value))}),f=x(()=>{var g,c;return!!((g=n.roles.creator)!=null&&g.includes(s.user._id)||(c=n.roles.admin)!=null&&c.includes(s.user._id))});return Le(()=>m(n.chat_id)),(g,c)=>(_(),S(oe,{class:"info"},{default:t(()=>[a(Y,null,{default:t(()=>[sa]),_:1}),a(Y,null,{default:t(()=>[a(T,null,{default:t(()=>[a(z,{avatar:""},{default:t(()=>[a(J,{avatar:e.avatar,name:e.name},null,8,["avatar","name"])]),_:1}),a(z,null,{default:t(()=>[a(D,{class:"text-h5"},{default:t(()=>[$(I(e.name),1)]),_:1}),a(D,{caption:""},{default:t(()=>[$(I(e.users_count)+" участников",1)]),_:1})]),_:1})]),_:1})]),_:1}),a(Y,null,{default:t(()=>[a(T,null,{default:t(()=>[a(z,{class:"text-center text-h6 q-mb-sm"},{default:t(()=>[$("Список участников")]),_:1})]),_:1}),a(te,{class:"q-mb-sm",modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=u=>r.value=u),label:"Найти",outlined:"",dense:""},null,8,["modelValue"]),o(h)?(_(),S(T,{key:0},{default:t(()=>[a(na,{showing:o(h)},{default:t(()=>[a(la,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1})):V("",!0),a(W,null,{default:t(()=>{var u;return[(_(!0),q(X,null,Z(o(M),v=>(_(),S(T,{key:v._id},{default:t(()=>[a(z,{avatar:""},{default:t(()=>[a(J,{name:v.name||"",avatar:v.avatar||""},null,8,["name","avatar"])]),_:2},1024),a(z,null,{default:t(()=>[$(I(v.name),1)]),_:2},1024),o(f)&&v._id!==o(s).user._id?(_(),S(z,{key:0,side:""},{default:t(()=>[a(R,{dense:"",flat:"",round:"",icon:"delete",loading:o(p),onClick:k=>o(l)(v._id)},null,8,["loading","onClick"])]),_:2},1024)):V("",!0)]),_:2},1024))),128)),!o(h)&&!((u=o(M))!=null&&u.length)?(_(),S(T,{key:0},{default:t(()=>[a(z,{class:"text-center"},{default:t(()=>[$("Ничего не найдено")]),_:1})]),_:1})):V("",!0)]}),_:1})]),_:1})]),_:1}))}});const ua=G(oa,[["__scopeId","data-v-2001a1c3"]]),ia={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ca={style:{padding:"0 10px 0 0"}},da=P({__name:"MessangerGroup",props:{currentChatId:null,currentChat:null},setup(e){const n=e,s=K(),r=ee(),m=C("add_user"),h=C(null),i=C(!1),l=x(()=>n.currentChat.messages),p=x(()=>l.value.reduce((c,u)=>[...c,new Date(u.createdAt)],[])),M=x(()=>{switch(m.value){case"add_user":return ta;case"info":return ua}});j(l,()=>{setTimeout(()=>{var u,v;const c=(u=h.value)==null?void 0:u.getScroll();(v=h.value)==null||v.setScrollPosition("vertical",(c==null?void 0:c.verticalSize)||0)},0)},{deep:!0,immediate:!0});function f(c){m.value=c,i.value=!i.value}async function g(){await H.leaveChat(n.currentChatId),r.chatsList=r.chatsList.filter(c=>c._id!==n.currentChatId),r.currentChatId=""}return(c,u)=>(_(),q("div",{class:A(["group",o(s).currentTheme==="dark"?"group_dark":"group_light"])},[a($e,{modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=v=>i.value=v)},{default:t(()=>{var v,k,L;return[(_(),S(Te(o(M)),{chat_id:e.currentChatId,avatar:(v=e.currentChat.group)==null?void 0:v.avatar,name:(k=e.currentChat.group)==null?void 0:k.title,users_count:e.currentChat.users.length,roles:(L=e.currentChat.group)==null?void 0:L.roles},null,8,["chat_id","avatar","name","users_count","roles"]))]}),_:1},8,["modelValue"]),a(T,{class:"group_title"},{default:t(()=>[a(z,{class:"back",avatar:""},{default:t(()=>[a(R,{icon:"arrow_back",color:"primary",dense:"",round:"",flat:"",onClick:u[1]||(u[1]=v=>o(r).currentChatId="")})]),_:1}),a(z,null,{default:t(()=>[a(D,{class:"text-h6"},{default:t(()=>{var v;return[$(I((v=e.currentChat.group)==null?void 0:v.title),1)]}),_:1}),a(D,{caption:""},{default:t(()=>[$(I(e.currentChat.users.length)+" участников ",1)]),_:1})]),_:1}),a(z,{side:"",style:{display:"flex","flex-direction":"row","align-items":"center","justify-content":"center"}},{default:t(()=>{var v;return[(v=o(r).currentChat.group)!=null&&v.roles.creator.includes(o(s).user._id)?(_(),S(R,{key:0,icon:"person_add",color:"primary",dense:"",round:"",flat:"",onClick:u[2]||(u[2]=k=>f("add_user"))})):V("",!0),a(R,{icon:"more_vert",round:"",dense:"",flat:"",color:"primary"},{default:t(()=>[a(Qe,null,{default:t(()=>[a(W,{bordered:""},{default:t(()=>[U((_(),S(T,{clickable:"",onClick:u[3]||(u[3]=k=>f("info"))},{default:t(()=>[a(z,{avatar:"",style:{"padding-right":"10px","min-width":"0"}},{default:t(()=>[a(B,{name:"info"})]),_:1}),a(z,null,{default:t(()=>[$("Информация о группе")]),_:1})]),_:1})),[[O],[se]]),U((_(),S(T,{class:"text-red",clickable:"",onClick:g},{default:t(()=>[a(z,{avatar:"",style:{"padding-right":"10px","min-width":"0"}},{default:t(()=>[a(B,{name:"logout"})]),_:1}),a(z,null,{default:t(()=>[$("Покинуть группу")]),_:1})]),_:1})),[[O],[se]])]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1}),a(Re,{class:"group_content",delay:"1200",ref_key:"dialogRef",ref:h},{default:t(()=>[(_(!0),q(X,null,Z(o(l),(v,k)=>{var L;return _(),S(Ae,{text:[v.text],sent:v.author===o(s).user._id,key:v._id,style:{padding:"0 20px"},"bg-color":v.author===o(s).user._id?"primary":"seconary","text-color":"white"},qe({name:t(()=>[$(I(v.author===o(s).user._id?"Я":e.currentChat.users.filter(F=>F._id===v.author)[0].name),1)]),stamp:t(()=>[Q("div",ia,[Q("div",ca,I(o(_e).showFilteredDate(o(p)[k])),1),v.author===o(s).user._id?(_(),S(B,{key:0,name:v.read.length>1?"mdi-check-all":"mdi-check"},null,8,["name"])):V("",!0)])]),_:2},[((L=v.attachments[0])==null?void 0:L.type)==="audio"?{name:"default",fn:t(()=>{var F;return[a(Pe,{src:`${o(de).SERVER_URL}/audio/${(F=v.attachments[0])==null?void 0:F.name}`},null,8,["src"])]}),key:"0"}:void 0]),1032,["text","sent","bg-color"])}),128))]),_:1},512),e.currentChatId?(_(),S(He,{key:0,style:{margin:"5px"}})):V("",!0)],2))}});const va=G(da,[["__scopeId","data-v-7798da5f"]]),ma=e=>(ve("data-v-a70283c5"),e=e(),me(),e),_a=ma(()=>Q("div",{class:"text-h5 text-center q-pb-lg"},"Создать группу",-1)),fa=P({__name:"MessangerFormCreateGroup",emits:["close"],setup(e,{emit:n}){const s=K(),r=ee(),m=C(""),{f:h,loading:i,data:l}=N({fn:()=>H.createGroup([s.user._id],m.value)});return j(l,()=>{l.value&&r.chatsList.push(l.value),n("close")}),(p,M)=>(_(),S(oe,{class:"content"},{default:t(()=>[a(Y,null,{default:t(()=>[_a,a(te,{modelValue:m.value,"onUpdate:modelValue":M[0]||(M[0]=f=>m.value=f),outlined:"",label:"Название"},null,8,["modelValue"])]),_:1}),a(Ue,{align:"center"},{default:t(()=>[a(R,{color:"primary",loading:o(i),onClick:o(h)},{default:t(()=>[$("Создать")]),_:1},8,["loading","onClick"])]),_:1})]),_:1}))}});const ha=G(fa,[["__scopeId","data-v-a70283c5"]]),ga={class:"container"},pa=P({__name:"Messanger",setup(e){K();const n=ee(),s=C(!1),r=pt(Me);j(()=>n.currentChat.type,(h,i)=>{switch(h){case"dialog":r.value=Me;break;case"group":r.value=va;break}});function m(){s.value=!s.value}return(h,i)=>(_(),S(It,{onOpenCreateGroup:m},{default:t(()=>[Q("div",ga,[a($e,{modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=l=>s.value=l)},{default:t(()=>[a(ha,{onClose:m})]),_:1},8,["modelValue"]),a(Ut,{"current-chat-id":o(n).currentChatId,chats:o(n).chatsList,class:A(o(n).currentChatId?"hide":"not_hide")},null,8,["current-chat-id","chats","class"]),o(n).currentChatId?(_(),S(Te(o(r)),{key:1,"current-chat-id":o(n).currentChatId,"current-chat":o(n).currentChat,class:A(o(n).currentChatId?"not_hide":"hide")},null,8,["current-chat-id","current-chat","class"])):(_(),q("div",{key:0,class:A(["dialog_not_selected",o(n).currentChatId?"not_hide":"hide"])},"Выберите, кому вы бы хотели написать",2))])]),_:1}))}});const Pa=G(pa,[["__scopeId","data-v-41f474d9"]]);export{Pa as default};
