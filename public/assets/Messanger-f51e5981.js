import{u as Je,a as Ke,Q as Me}from"./QDialog-db694845.js";import{Q as F,R as B,p as Ze,m as et,n as tt,a as at}from"./QBtn-84d97db2.js";import{Q as lt,c as nt,b as rt,a as st,d as ot,e as ye,f as ut}from"./QLayout-3fbeca0d.js";import{c as it,Q as se,b as N,a as ct}from"./QCardSection-d26faa53.js";import{d as R,o as v,c as S,b as t,g as x,a2 as I,a3 as L,k as u,a4 as de,a1 as U,a0 as H,_ as G,u as W,r as k,e as a,f as Q,E as D,Q as A,a5 as dt,aG as ee,n as z,aH as O,ax as we,w as J,aa as E,a9 as K,m as oe,q as y,ac as vt,ae as mt,af as _t,D as ft,X as ht,v as Ie,B as Le,aI as qe,p as ve,i as me,O as gt,l as Te,s as pt}from"./index-daaabc4f.js";import{Q as q,a as C}from"./selection-a01cad79.js";import{Q as Y}from"./QList-bcae5e36.js";import{Q as ue}from"./QInput-f9d1dd50.js";import{b as V,Q as Qe}from"./QItemLabel-c4ac9f6a.js";import{u as Z,a as Ue,b as Ve}from"./use-key-composition-88659357.js";import{T as Ce}from"./TouchPan-ab0145b5.js";import{b as ne}from"./format-7389883c.js";import{e as ie,s as Se}from"./scroll-f9fbc6b4.js";import{C as re}from"./ClosePopup-261f1e7e.js";import{M as De}from"./MessangerInput-a056115a.js";import{Q as bt}from"./QLinearProgress-f811b116.js";import{Q as He}from"./QCardActions-d42c9939.js";import"./use-prevent-scroll-f90505a2.js";import"./use-timeout-af311404.js";import"./use-tick-b9bb58f2.js";import"./focus-manager-e79c27be.js";import"./uid-6a237b22.js";class _e{static convertDay(n){return n<10?`0${n}`:n}static convertMonth(n){return n+1<10?`0${n+1}`:n+1}static convertYear(n){return n}static convertHours(n){return n<10?`0${n}`:n}static convertMinutes(n){return n<10?`0${n}`:n}static timeStruct(n){return{year:n.getFullYear(),month:n.getMonth(),day:n.getDate(),hours:n.getHours(),minutes:n.getMinutes()}}static showFilteredDate(n){const s=new Date,o=this.timeStruct(s),m=this.timeStruct(n);return o.year===m.year&&o.month===m.month&&o.day===m.day?`${this.convertHours(m.hours)}:${this.convertMinutes(m.minutes)}`:o.year===m.year?`${this.convertDay(m.day)}.${this.convertMonth(m.month)}`:`${this.convertDay(m.day)}.${this.convertMonth(m.month)}.${this.convertYear(m.year)}`}}const yt=["src"],Ct=R({__name:"UserAvatar",props:{avatar:null,name:null,size:{default:"45px"},color:{default:"secondary"}},setup(e){return(n,s)=>(v(),S(it,{class:H(n.$style.avatar),size:e.size,color:e.color},{default:t(()=>[x(I(e.avatar?"":e.name.slice(0,1)),1),e.avatar?(v(),L("img",{key:0,src:`${u(de).SERVER_URL}/avatars/${e.avatar}`},null,8,yt)):U("",!0)]),_:1},8,["class","size","color"]))}}),St="_avatar_1dacu_1",zt={avatar:St},kt={$style:zt},X=G(Ct,[["__cssModules",kt]]),xt={class:"user_name"},$t={class:"user_status"},Mt=R({__name:"ChatLayout",emits:["openCreateGroup"],setup(e,{emit:n}){const s=W(),o=k(!1);function m(){o.value=!o.value}return(g,d)=>(v(),S(lt,{class:H(u(s).currentTheme==="dark"?"dark":"light"),view:"hHh lpR fFf"},{default:t(()=>[a(st,{class:"header",bordered:""},{default:t(()=>[a(nt,null,{default:t(()=>[a(F,{icon:"menu",dense:"",flat:"",round:"",onClick:m}),a(rt,null,{default:t(()=>[x("Мессенджер")]),_:1})]),_:1})]),_:1}),a(ct,{modelValue:o.value,"onUpdate:modelValue":d[1]||(d[1]=l=>o.value=l),side:"left",overlay:"",bordered:""},{default:t(()=>[a(Y,{class:"list"},{default:t(()=>[a(se,{class:"user_info",flat:"",square:""},{default:t(()=>[a(N,null,{default:t(()=>[a(X,{name:u(s).user.name,avatar:u(s).user.avatar},null,8,["name","avatar"]),Q("div",xt,I(u(s).user.name),1),Q("div",$t,I(u(s).user.status),1)]),_:1})]),_:1}),D((v(),S(q,{class:"list_item",clickable:"",tag:"a",to:"/","active-class":"active"},{default:t(()=>[a(C,{avatar:""},{default:t(()=>[a(A,{name:"home"})]),_:1}),a(C,null,{default:t(()=>[x("На главную")]),_:1})]),_:1})),[[B]]),D((v(),S(q,{class:"list_item",clickable:"",tag:"a",to:"/account","active-class":"active"},{default:t(()=>[a(C,{avatar:""},{default:t(()=>[a(A,{name:"account_circle"})]),_:1}),a(C,null,{default:t(()=>[x("Аккаунт")]),_:1})]),_:1})),[[B]]),D((v(),S(q,{class:"list_item",clickable:"","active-class":"active",onClick:d[0]||(d[0]=l=>[n("openCreateGroup"),m()])},{default:t(()=>[a(C,{avatar:""},{default:t(()=>[a(A,{name:"note_add"})]),_:1}),a(C,null,{default:t(()=>[x("Создать группу")]),_:1})]),_:1})),[[B]])]),_:1})]),_:1},8,["modelValue"]),a(ot,{style:{height:"100vh"}},{default:t(()=>[dt(g.$slots,"default",{},void 0,!0)]),_:3})]),_:3},8,["class"]))}});const wt=G(Mt,[["__scopeId","data-v-3340b5b0"]]),It={class:"chats"},Lt={key:0,class:"text-center"},qt={key:0,class:"text-center"},Tt={style:{display:"flex","align-items":"center"}},Qt={key:0,class:"unread_count"},Ut=R({__name:"MessangerChatsList",props:{currentChatId:null,chats:null},setup(e){const n=W(),s=ee(),o=k(""),m=z(()=>s.chatsList.reduce((_,h)=>[..._,new Date(h.updatedAt)],[])),{f:g,data:d,loading:l}=Z({fn:O.findUsers}),p=we.throttleDecorator(g,1e3);J(o,(_,h)=>{_?p(o.value):d.value=[]});async function $(_){const h=await O.createChat([n.user._id,_]),i=s.chatsList.find(r=>r._id===h.data._id);i?(s.currentChatId=i._id,s.onOpenChat(i._id)):(s.currentChatId=h.data._id,s.chatsList.push(h.data)),o.value=""}return(_,h)=>(v(),L("div",It,[a(ue,{modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=i=>o.value=i),label:"Поиск",outlined:"",dense:"",clearable:""},null,8,["modelValue"]),o.value?(v(),S(Y,{key:0,class:"chats_list"},{default:t(()=>{var i;return[(i=u(d))!=null&&i.length?U("",!0):(v(),L("h6",Lt,"Ничего не найдено")),(v(!0),L(E,null,K(u(d),r=>D((v(),S(q,{clickable:"",onClick:f=>$(r._id)},{default:t(()=>[a(C,{avatar:""},{default:t(()=>[a(X,{name:r.name,avatar:r.avatar},null,8,["name","avatar"])]),_:2},1024),a(C,null,{default:t(()=>[x(I(r.name),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[B]])),256))]}),_:1})):(v(),S(Y,{key:1,class:"chats_list"},{default:t(()=>{var i;return[(i=e.chats)!=null&&i.length?U("",!0):(v(),L("h6",qt,"Список диалогов пуст")),(v(!0),L(E,null,K(e.chats,(r,f)=>D((v(),S(q,{class:"list_item",clickable:"","active-class":u(n).currentTheme==="dark"?"active_dark":"active_light",active:e.currentChatId===r._id,onClick:w=>u(s).onOpenChat(r._id)},{default:t(()=>[a(C,{avatar:""},{default:t(()=>{var w,T;return[a(X,{name:r.type==="dialog"?r.companion.name:((w=r.group)==null?void 0:w.title)||"",avatar:r.type==="dialog"?r.companion.avatar:((T=r.group)==null?void 0:T.avatar)||""},null,8,["name","avatar"])]}),_:2},1024),a(C,null,{default:t(()=>[a(V,null,{default:t(()=>{var w;return[x(I(r.type==="dialog"?r.companion.name:(w=r.group)==null?void 0:w.title),1)]}),_:2},1024),a(V,{caption:"",lines:"2"},{default:t(()=>{var w,T;return[x(I(r.messages.length?((T=(w=r==null?void 0:r.messages)==null?void 0:w.at(-1))==null?void 0:T.text)||"Аудиосообщение":"Еще нет сообщений"),1)]}),_:2},1024)]),_:2},1024),a(C,{side:"",top:"",bottom:""},{default:t(()=>[a(V,{caption:""},{default:t(()=>{var w,T,P;return[Q("div",Tt,[r.type==="dialog"&&((T=(w=r.messages)==null?void 0:w.at(-1))==null?void 0:T.author)===u(n).user._id?(v(),S(A,{key:0,name:(P=r.messages.at(-1))!=null&&P.read.includes(r.companion._id)?"mdi-check-all":"mdi-check",style:{"padding-right":"5px"}},null,8,["name"])):U("",!0),Q("div",null,I(`${u(_e).showFilteredDate(u(m)[f])}`),1)]),+r.unread?(v(),L("div",Qt,[Q("span",null,I(r.unread),1)])):U("",!0)]}),_:2},1024)]),_:2},1024)]),_:2},1032,["active-class","active","onClick"])),[[B]])),256))]}),_:1}))]))}});const Vt=G(Ut,[["__scopeId","data-v-da21eddc"]]),Pe=oe({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(e,{slots:n}){const s=z(()=>e.sent===!0?"sent":"received"),o=z(()=>`q-message-text-content q-message-text-content--${s.value}`+(e.textColor!==void 0?` text-${e.textColor}`:"")),m=z(()=>`q-message-text q-message-text--${s.value}`+(e.bgColor!==void 0?` text-${e.bgColor}`:"")),g=z(()=>"q-message-container row items-end no-wrap"+(e.sent===!0?" reverse":"")),d=z(()=>e.size!==void 0?`col-${e.size}`:""),l=z(()=>({msg:e.textHtml===!0?"innerHTML":"textContent",stamp:e.stampHtml===!0?"innerHTML":"textContent",name:e.nameHtml===!0?"innerHTML":"textContent",label:e.labelHtml===!0?"innerHTML":"textContent"}));function p(_){return n.stamp!==void 0?[_,y("div",{class:"q-message-stamp"},n.stamp())]:e.stamp?[_,y("div",{class:"q-message-stamp",[l.value.stamp]:e.stamp})]:[_]}function $(_,h){const i=h===!0?_.length>1?r=>r:r=>y("div",[r]):r=>y("div",{[l.value.msg]:r});return _.map((r,f)=>y("div",{key:f,class:m.value},[y("div",{class:o.value},p(i(r)))]))}return()=>{const _=[];n.avatar!==void 0?_.push(n.avatar()):e.avatar!==void 0&&_.push(y("img",{class:`q-message-avatar q-message-avatar--${s.value}`,src:e.avatar,"aria-hidden":"true"}));const h=[];n.name!==void 0?h.push(y("div",{class:`q-message-name q-message-name--${s.value}`},n.name())):e.name!==void 0&&h.push(y("div",{class:`q-message-name q-message-name--${s.value}`,[l.value.name]:e.name})),n.default!==void 0?h.push($(Ze(n.default()),!0)):e.text!==void 0&&h.push($(e.text)),_.push(y("div",{class:d.value},h));const i=[];return n.label!==void 0?i.push(y("div",{class:"q-message-label"},n.label())):e.label!==void 0&&i.push(y("div",{class:"q-message-label",[l.value.label]:e.label})),i.push(y("div",{class:g.value},_)),y("div",{class:`q-message q-message-${s.value}`},i)}}}),ze=["vertical","horizontal"],ce={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},ke={prevent:!0,mouse:!0,mouseAllDir:!0},xe=e=>e>=250?50:Math.ceil(e/5),Ae=oe({name:"QScrollArea",props:{...Ue,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:n,emit:s}){const o=k(!1),m=k(!1),g=k(!1),d={vertical:k(0),horizontal:k(0)},l={vertical:{ref:k(null),position:k(0),size:k(0)},horizontal:{ref:k(null),position:k(0),size:k(0)}},{proxy:p}=Ie(),$=Ve(e,p.$q);let _=null,h;const i=k(null),r=z(()=>"q-scrollarea"+($.value===!0?" q-scrollarea--dark":""));l.vertical.percentage=z(()=>{const c=l.vertical.size.value-d.vertical.value;if(c<=0)return 0;const b=ne(l.vertical.position.value/c,0,1);return Math.round(b*1e4)/1e4}),l.vertical.thumbHidden=z(()=>(e.visible===null?g.value:e.visible)!==!0&&o.value===!1&&m.value===!1||l.vertical.size.value<=d.vertical.value+1),l.vertical.thumbStart=z(()=>l.vertical.percentage.value*(d.vertical.value-l.vertical.thumbSize.value)),l.vertical.thumbSize=z(()=>Math.round(ne(d.vertical.value*d.vertical.value/l.vertical.size.value,xe(d.vertical.value),d.vertical.value))),l.vertical.style=z(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${l.vertical.thumbStart.value}px`,height:`${l.vertical.thumbSize.value}px`})),l.vertical.thumbClass=z(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(l.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),l.vertical.barClass=z(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(l.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),l.horizontal.percentage=z(()=>{const c=l.horizontal.size.value-d.horizontal.value;if(c<=0)return 0;const b=ne(Math.abs(l.horizontal.position.value)/c,0,1);return Math.round(b*1e4)/1e4}),l.horizontal.thumbHidden=z(()=>(e.visible===null?g.value:e.visible)!==!0&&o.value===!1&&m.value===!1||l.horizontal.size.value<=d.horizontal.value+1),l.horizontal.thumbStart=z(()=>l.horizontal.percentage.value*(d.horizontal.value-l.horizontal.thumbSize.value)),l.horizontal.thumbSize=z(()=>Math.round(ne(d.horizontal.value*d.horizontal.value/l.horizontal.size.value,xe(d.horizontal.value),d.horizontal.value))),l.horizontal.style=z(()=>({...e.thumbStyle,...e.horizontalThumbStyle,[p.$q.lang.rtl===!0?"right":"left"]:`${l.horizontal.thumbStart.value}px`,width:`${l.horizontal.thumbSize.value}px`})),l.horizontal.thumbClass=z(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(l.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),l.horizontal.barClass=z(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(l.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const f=z(()=>l.vertical.thumbHidden.value===!0&&l.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),w=[[Ce,c=>{ge(c,"vertical")},void 0,{vertical:!0,...ke}]],T=[[Ce,c=>{ge(c,"horizontal")},void 0,{horizontal:!0,...ke}]];function P(){const c={};return ze.forEach(b=>{const M=l[b];c[b+"Position"]=M.position.value,c[b+"Percentage"]=M.percentage.value,c[b+"Size"]=M.size.value,c[b+"ContainerSize"]=d[b].value}),c}const fe=vt(()=>{const c=P();c.ref=p,s("scroll",c)},0);function he(c,b,M){if(ze.includes(c)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(c==="vertical"?Se:ie)(i.value,b,M)}function Ge({height:c,width:b}){let M=!1;d.vertical.value!==c&&(d.vertical.value=c,M=!0),d.horizontal.value!==b&&(d.horizontal.value=b,M=!0),M===!0&&te()}function Fe({position:c}){let b=!1;l.vertical.position.value!==c.top&&(l.vertical.position.value=c.top,b=!0),l.horizontal.position.value!==c.left&&(l.horizontal.position.value=c.left,b=!0),b===!0&&te()}function Be({height:c,width:b}){l.horizontal.size.value!==b&&(l.horizontal.size.value=b,te()),l.vertical.size.value!==c&&(l.vertical.size.value=c,te())}function ge(c,b){const M=l[b];if(c.isFirst===!0){if(M.thumbHidden.value===!0)return;h=M.position.value,m.value=!0}else if(m.value!==!0)return;c.isFinal===!0&&(m.value=!1);const j=ce[b],le=d[b].value,Ye=(M.size.value-le)/(le-M.thumbSize.value),Xe=c.distance[j.dist],We=h+(c.direction===j.dir?1:-1)*Xe*Ye;be(We,b)}function pe(c,b){const M=l[b];if(M.thumbHidden.value!==!0){const j=c[ce[b].offset];if(j<M.thumbStart.value||j>M.thumbStart.value+M.thumbSize.value){const le=j-M.thumbSize.value/2;be(le/d[b].value*M.size.value,b)}M.ref.value!==null&&M.ref.value.dispatchEvent(new MouseEvent(c.type,c))}}function Oe(c){pe(c,"vertical")}function je(c){pe(c,"horizontal")}function te(){o.value=!0,_!==null&&clearTimeout(_),_=setTimeout(()=>{_=null,o.value=!1},e.delay),e.onScroll!==void 0&&fe()}function be(c,b){i.value[ce[b].scroll]=c}function Ne(){g.value=!0}function Ee(){g.value=!1}let ae=null;return J(()=>p.$q.lang.rtl,c=>{i.value!==null&&ie(i.value,Math.abs(l.horizontal.position.value)*(c===!0?-1:1))}),mt(()=>{ae={top:l.vertical.position.value,left:l.horizontal.position.value}}),_t(()=>{if(ae===null)return;const c=i.value;c!==null&&(ie(c,ae.left),Se(c,ae.top))}),ft(fe.cancel),Object.assign(p,{getScrollTarget:()=>i.value,getScroll:P,getScrollPosition:()=>({top:l.vertical.position.value,left:l.horizontal.position.value}),getScrollPercentage:()=>({top:l.vertical.percentage.value,left:l.horizontal.percentage.value}),setScrollPosition:he,setScrollPercentage(c,b,M){he(c,b*(l[c].size.value-d[c].value)*(c==="horizontal"&&p.$q.lang.rtl===!0?-1:1),M)}}),()=>y("div",{class:r.value,onMouseenter:Ne,onMouseleave:Ee},[y("div",{ref:i,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[y("div",{class:"q-scrollarea__content absolute",style:f.value},ht(n.default,[y(ye,{debounce:0,onResize:Be})])),y(ut,{axis:"both",onScroll:Fe})]),y(ye,{debounce:0,onResize:Ge}),y("div",{class:l.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:Oe}),y("div",{class:l.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:je}),D(y("div",{ref:l.vertical.ref,class:l.vertical.thumbClass.value,style:l.vertical.style.value,"aria-hidden":"true"}),w),D(y("div",{ref:l.horizontal.ref,class:l.horizontal.thumbClass.value,style:l.horizontal.style.value,"aria-hidden":"true"}),T)])}}),Dt=["src"],Ht=R({__name:"MessangerVoiceMessage",props:{src:null},setup(e){const n=k(null),s=k(!1),o=k(0),m=k(0),g=k(0);Le(()=>{n.value&&(n.value.onplay=()=>s.value=!0,n.value.onpause=()=>s.value=!1,n.value.ontimeupdate=l=>{const p=l.target;g.value=(p.duration/100).toFixed(2).replace(".",":"),m.value=(p.currentTime/100).toFixed(2).replace(".",":"),o.value=Math.round(p.currentTime*100/p.duration)/100},n.value.onended=()=>o.value=0)});function d(){var l,p;s.value?(l=n.value)==null||l.pause():(p=n.value)==null||p.play()}return(l,p)=>(v(),L(E,null,[Q("audio",{ref_key:"audio",ref:n,src:e.src,preload:"metadata",volume:1},null,8,Dt),Q("div",{class:H(l.$style.audio)},[a(A,{name:s.value?"stop_circle":"play_circle",onClick:d,size:"40px",color:"white"},null,8,["name"]),Q("div",{class:H(l.$style.audio_info)},[a(bt,{value:o.value,"instant-feedback":"",color:"pink",class:H(l.$style.audio_progress)},null,8,["value","class"]),m.value&&g.value?(v(),L("div",{key:0,class:H(l.$style.audio_time)},I(m.value+" / "+g.value),3)):U("",!0)],2)],2)],64))}}),Pt="_audio_16ywe_1",At="_audio_info_16ywe_9",Rt="_audio_time_16ywe_12",Gt="_audio_progress_16ywe_16",Ft={audio:Pt,audio_info:At,audio_time:Rt,audio_progress:Gt},Bt={$style:Ft},Re=G(Ht,[["__cssModules",Bt]]),Ot={style:{display:"flex","justify-content":"space-between","align-items":"center"}},jt={style:{padding:"0 10px 0 0"}},Nt=R({__name:"MessangerDialog",props:{currentChatId:null,currentChat:null},setup(e){const n=e,s=W(),o=ee(),m=k(null),g=z(()=>n.currentChat.messages),d=z(()=>g.value.reduce((p,$)=>[...p,new Date($.createdAt)],[]));J(g,()=>{setTimeout(()=>{var $,_;const p=($=m.value)==null?void 0:$.getScroll();(_=m.value)==null||_.setScrollPosition("vertical",(p==null?void 0:p.verticalSize)||0)},0)},{deep:!0,immediate:!0});async function l(){await O.deleteChat(n.currentChatId),o.chatsList=o.chatsList.filter(p=>p._id!==n.currentChatId),o.currentChatId=""}return(p,$)=>(v(),L("div",{class:H(["dialog",u(s).currentTheme==="dark"?"dialog_dark":"dialog_light"])},[a(q,{class:"dialog_name"},{default:t(()=>[a(C,{class:"back",avatar:""},{default:t(()=>[a(F,{dense:"",round:"",flat:"",icon:"arrow_back",color:"primary",onClick:$[0]||($[0]=_=>u(o).currentChatId="")})]),_:1}),a(C,null,{default:t(()=>[a(V,{class:"text-h6"},{default:t(()=>[x(I(e.currentChat.companion.name),1)]),_:1}),a(V,{caption:""},{default:t(()=>[x(I(e.currentChat.companion.status),1)]),_:1})]),_:1}),a(C,{side:""},{default:t(()=>[a(F,{icon:"more_vert",round:"",dense:"",flat:"",color:"primary"},{default:t(()=>[a(Qe,null,{default:t(()=>[a(Y,{bordered:""},{default:t(()=>[D((v(),S(q,{class:"text-red",clickable:"",onClick:l},{default:t(()=>[a(C,{avatar:"",style:{"padding-right":"10px","min-width":"0"}},{default:t(()=>[a(A,{name:"delete"})]),_:1}),a(C,null,{default:t(()=>[x("Удалить чат")]),_:1})]),_:1})),[[B],[re]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Ae,{class:"dialog_content",delay:"1200",ref_key:"dialogRef",ref:m},{default:t(()=>[(v(!0),L(E,null,K(u(g),(_,h)=>{var i;return v(),S(Pe,{text:[_.text],sent:_.author===u(s).user._id,key:_._id,style:{padding:"0 20px"},"bg-color":_.author===u(s).user._id?"primary":"teal","text-color":"white"},qe({stamp:t(()=>[Q("div",Ot,[Q("div",jt,I(u(_e).showFilteredDate(u(d)[h])),1),_.author===u(s).user._id?(v(),S(A,{key:0,name:_.read.includes(e.currentChat.companion._id)?"mdi-check-all":"mdi-check"},null,8,["name"])):U("",!0)])]),_:2},[((i=_.attachments.at(0))==null?void 0:i.type)==="audio"?{name:"default",fn:t(()=>{var r;return[a(Re,{src:`${u(de).SERVER_URL}/audio/${(r=_.attachments.at(0))==null?void 0:r.name}`},null,8,["src"])]}),key:"0"}:void 0]),1032,["text","sent","bg-color"])}),128))]),_:1},512),e.currentChatId?(v(),S(De,{key:0,style:{margin:"5px"}})):U("",!0)],2))}});const $e=G(Nt,[["__scopeId","data-v-0e3a8c22"]]),Et=e=>(ve("data-v-4b1506dd"),e=e(),me(),e),Yt=Et(()=>Q("div",{class:"title text-h6 text-center"},"Добавить в группу",-1)),Xt={key:0,class:"text-center"},Wt=R({__name:"MessangerGroupAddUser",props:{chat_id:null},setup(e){const n=e,s=k(""),o=k(null),{f:m,data:g,loading:d}=Z({fn:O.findUsers}),l=we.throttleDecorator(m,1e3),{f:p,loading:$}=Z({fn:()=>{var h;return O.addUserToGroup(n.chat_id,(h=o.value)==null?void 0:h._id)},successMsg:"Пользователь добавлен в чат",alert:!0});J(s,(h,i)=>{h?(l(s.value),o.value=null):g.value=[]});function _(h){o.value=h,s.value=""}return(h,i)=>(v(),S(se,{class:"add"},{default:t(()=>[a(N,null,{default:t(()=>[Yt,a(ue,{modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=r=>s.value=r),outlined:"",loading:u(d),label:"Имя или логин",clearable:""},null,8,["modelValue","loading"])]),_:1}),a(N,{style:{padding:"0"}},{default:t(()=>{var r;return[a(Y,null,{default:t(()=>[o.value?(v(),S(q,{key:1,"active-class":"active",active:!!o.value,clickable:"",onClick:i[1]||(i[1]=f=>o.value=null)},{default:t(()=>[a(C,{avatar:""},{default:t(()=>[a(X,{name:o.value.name,avatar:o.value.avatar},null,8,["name","avatar"])]),_:1}),a(C,{side:""},{default:t(()=>[a(V,null,{default:t(()=>[x(I(o.value.name),1)]),_:1}),a(V,null,{default:t(()=>[x(I(o.value.login),1)]),_:1})]),_:1})]),_:1},8,["active"])):(v(!0),L(E,{key:0},K(u(g),f=>D((v(),S(q,{clickable:"",onClick:w=>_(f)},{default:t(()=>[a(C,{avatar:""},{default:t(()=>[a(X,{name:f.name,avatar:f.avatar},null,8,["name","avatar"])]),_:2},1024),a(C,{side:""},{default:t(()=>[a(V,null,{default:t(()=>[x(I(f.name),1)]),_:2},1024),a(V,null,{default:t(()=>[x(I(f.login),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[B]])),256))]),_:1}),!((r=u(g))!=null&&r.length)&&s.value?(v(),L("div",Xt,"Не найдено ни одного человека")):U("",!0)]}),_:1}),a(He,{align:"center"},{default:t(()=>[D((v(),S(F,{color:"primary",disable:!o.value,loading:u($),onClick:u(p)},{default:t(()=>[x("Добавить")]),_:1},8,["disable","loading","onClick"])),[[re]])]),_:1})]),_:1}))}});const Jt=G(Wt,[["__scopeId","data-v-4b1506dd"]]),Kt=[y("g",{transform:"translate(-20,-20)"},[y("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[y("animateTransform",{attributeName:"transform",type:"rotate",from:"90 50 50",to:"0 50 50",dur:"1s",repeatCount:"indefinite"})])]),y("g",{transform:"translate(20,20) rotate(15 50 50)"},[y("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[y("animateTransform",{attributeName:"transform",type:"rotate",from:"0 50 50",to:"90 50 50",dur:"1s",repeatCount:"indefinite"})])])],Zt=oe({name:"QSpinnerGears",props:et,setup(e){const{cSize:n,classes:s}=tt(e);return()=>y("svg",{class:s.value,width:n.value,height:n.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"},Kt)}}),ea=oe({name:"QInnerLoading",props:{...Ue,...Je,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:n}){const s=Ie(),o=Ve(e,s.proxy.$q),{transitionProps:m,transitionStyle:g}=Ke(e),d=z(()=>"q-inner-loading absolute-full column flex-center"+(o.value===!0?" q-inner-loading--dark":"")),l=z(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function p(){const _=[y(at,{size:e.size,color:e.color})];return e.label!==void 0&&_.push(y("div",{class:l.value,style:e.labelStyle},[e.label])),_}function $(){return e.showing===!0?y("div",{class:d.value,style:g.value},n.default!==void 0?n.default():p()):null}return()=>y(gt,m.value,$)}}),ta=e=>(ve("data-v-2001a1c3"),e=e(),me(),e),aa=ta(()=>Q("div",{class:"title text-h5 text-center"},"Информация о группе",-1)),la=R({__name:"MessangerGroupInfo",props:{avatar:null,name:null,chat_id:null,users_count:null,roles:null},setup(e){const n=e,s=W(),o=k(""),{f:m,loading:g,data:d}=Z({fn:O.getUsersListInChat}),{f:l,loading:p}=Z({fn:h=>{var i;O.removeUserFromGroup(n.chat_id,h),d.value=(i=d.value)==null?void 0:i.filter(r=>r._id!==h)}}),$=z(()=>{var h;return(h=d.value)==null?void 0:h.filter(i=>i.name.includes(o.value)||i.login.includes(o.value))}),_=z(()=>{var h,i;return!!((h=n.roles.creator)!=null&&h.includes(s.user._id)||(i=n.roles.admin)!=null&&i.includes(s.user._id))});return Le(()=>m(n.chat_id)),(h,i)=>(v(),S(se,{class:"info"},{default:t(()=>[a(N,null,{default:t(()=>[aa]),_:1}),a(N,null,{default:t(()=>[a(q,null,{default:t(()=>[a(C,{avatar:""},{default:t(()=>[a(X,{avatar:e.avatar,name:e.name},null,8,["avatar","name"])]),_:1}),a(C,null,{default:t(()=>[a(V,{class:"text-h5"},{default:t(()=>[x(I(e.name),1)]),_:1}),a(V,{caption:""},{default:t(()=>[x(I(e.users_count)+" участников",1)]),_:1})]),_:1})]),_:1})]),_:1}),a(N,null,{default:t(()=>[a(q,null,{default:t(()=>[a(C,{class:"text-center text-h6 q-mb-sm"},{default:t(()=>[x("Список участников")]),_:1})]),_:1}),a(ue,{class:"q-mb-sm",modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=r=>o.value=r),label:"Найти",outlined:"",dense:""},null,8,["modelValue"]),u(g)?(v(),S(q,{key:0},{default:t(()=>[a(ea,{showing:u(g)},{default:t(()=>[a(Zt,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1})):U("",!0),a(Y,null,{default:t(()=>{var r;return[(v(!0),L(E,null,K(u($),f=>(v(),S(q,{key:f._id},{default:t(()=>[a(C,{avatar:""},{default:t(()=>[a(X,{name:f.name||"",avatar:f.avatar||""},null,8,["name","avatar"])]),_:2},1024),a(C,null,{default:t(()=>[x(I(f.name),1)]),_:2},1024),u(_)&&f._id!==u(s).user._id?(v(),S(C,{key:0,side:""},{default:t(()=>[a(F,{dense:"",flat:"",round:"",icon:"delete",loading:u(p),onClick:w=>u(l)(f._id)},null,8,["loading","onClick"])]),_:2},1024)):U("",!0)]),_:2},1024))),128)),!u(g)&&!((r=u($))!=null&&r.length)?(v(),S(q,{key:0},{default:t(()=>[a(C,{class:"text-center"},{default:t(()=>[x("Ничего не найдено")]),_:1})]),_:1})):U("",!0)]}),_:1})]),_:1})]),_:1}))}});const na=G(la,[["__scopeId","data-v-2001a1c3"]]),ra={style:{display:"flex","justify-content":"space-between","align-items":"center"}},sa={style:{padding:"0 10px 0 0"}},oa=R({__name:"MessangerGroup",props:{currentChatId:null,currentChat:null},setup(e){const n=e,s=W(),o=ee(),m=k("add_user"),g=k(null),d=k(!1),l=z(()=>n.currentChat.messages),p=z(()=>l.value.reduce((i,r)=>[...i,new Date(r.createdAt)],[])),$=z(()=>{switch(m.value){case"add_user":return Jt;case"info":return na}});J(l,()=>{setTimeout(()=>{var r,f;const i=(r=g.value)==null?void 0:r.getScroll();(f=g.value)==null||f.setScrollPosition("vertical",(i==null?void 0:i.verticalSize)||0)},0)},{deep:!0,immediate:!0});function _(i){m.value=i,d.value=!d.value}async function h(){await O.leaveChat(n.currentChatId),o.chatsList=o.chatsList.filter(i=>i._id!==n.currentChatId),o.currentChatId=""}return(i,r)=>(v(),L("div",{class:H(["group",u(s).currentTheme==="dark"?"group_dark":"group_light"])},[a(Me,{modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=f=>d.value=f)},{default:t(()=>{var f,w,T;return[(v(),S(Te(u($)),{chat_id:e.currentChatId,avatar:(f=e.currentChat.group)==null?void 0:f.avatar,name:(w=e.currentChat.group)==null?void 0:w.title,users_count:e.currentChat.users.length,roles:(T=e.currentChat.group)==null?void 0:T.roles},null,8,["chat_id","avatar","name","users_count","roles"]))]}),_:1},8,["modelValue"]),a(q,{class:"group_title"},{default:t(()=>[a(C,{class:"back",avatar:""},{default:t(()=>[a(F,{icon:"arrow_back",color:"primary",dense:"",round:"",flat:"",onClick:r[1]||(r[1]=f=>u(o).currentChatId="")})]),_:1}),a(C,null,{default:t(()=>[a(V,{class:"text-h6"},{default:t(()=>{var f;return[x(I((f=e.currentChat.group)==null?void 0:f.title),1)]}),_:1}),a(V,{caption:""},{default:t(()=>[x(I(e.currentChat.users.length)+" участников ",1)]),_:1})]),_:1}),a(C,{side:"",style:{display:"flex","flex-direction":"row","align-items":"center","justify-content":"center"}},{default:t(()=>{var f;return[(f=u(o).currentChat.group)!=null&&f.roles.creator.includes(u(s).user._id)?(v(),S(F,{key:0,icon:"person_add",color:"primary",dense:"",round:"",flat:"",onClick:r[2]||(r[2]=w=>_("add_user"))})):U("",!0),a(F,{icon:"more_vert",round:"",dense:"",flat:"",color:"primary"},{default:t(()=>[a(Qe,null,{default:t(()=>[a(Y,{bordered:""},{default:t(()=>[D((v(),S(q,{clickable:"",onClick:r[3]||(r[3]=w=>_("info"))},{default:t(()=>[a(C,{avatar:"",style:{"padding-right":"10px","min-width":"0"}},{default:t(()=>[a(A,{name:"info"})]),_:1}),a(C,null,{default:t(()=>[x("Информация о группе")]),_:1})]),_:1})),[[B],[re]]),D((v(),S(q,{class:"text-red",clickable:"",onClick:h},{default:t(()=>[a(C,{avatar:"",style:{"padding-right":"10px","min-width":"0"}},{default:t(()=>[a(A,{name:"logout"})]),_:1}),a(C,null,{default:t(()=>[x("Покинуть группу")]),_:1})]),_:1})),[[B],[re]])]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1}),a(Ae,{class:"group_content",delay:"1200",ref_key:"dialogRef",ref:g},{default:t(()=>[(v(!0),L(E,null,K(u(l),(f,w)=>{var T;return v(),S(Pe,{text:[f.text],sent:f.author===u(s).user._id,key:f._id,style:{padding:"0 20px"},"bg-color":f.author===u(s).user._id?"primary":"seconary","text-color":"white"},qe({name:t(()=>[x(I(f.author===u(s).user._id?"Я":e.currentChat.users.filter(P=>P._id===f.author)[0].name),1)]),stamp:t(()=>[Q("div",ra,[Q("div",sa,I(u(_e).showFilteredDate(u(p)[w])),1),f.author===u(s).user._id?(v(),S(A,{key:0,name:f.read.length>1?"mdi-check-all":"mdi-check"},null,8,["name"])):U("",!0)])]),_:2},[((T=f.attachments[0])==null?void 0:T.type)==="audio"?{name:"default",fn:t(()=>{var P;return[a(Re,{src:`${u(de).SERVER_URL}/audio/${(P=f.attachments[0])==null?void 0:P.name}`},null,8,["src"])]}),key:"0"}:void 0]),1032,["text","sent","bg-color"])}),128))]),_:1},512),e.currentChatId?(v(),S(De,{key:0,style:{margin:"5px"}})):U("",!0)],2))}});const ua=G(oa,[["__scopeId","data-v-7798da5f"]]),ia=e=>(ve("data-v-a70283c5"),e=e(),me(),e),ca=ia(()=>Q("div",{class:"text-h5 text-center q-pb-lg"},"Создать группу",-1)),da=R({__name:"MessangerFormCreateGroup",emits:["close"],setup(e,{emit:n}){const s=W(),o=ee(),m=k(""),{f:g,loading:d,data:l}=Z({fn:()=>O.createGroup([s.user._id],m.value)});return J(l,()=>{l.value&&o.chatsList.push(l.value),n("close")}),(p,$)=>(v(),S(se,{class:"content"},{default:t(()=>[a(N,null,{default:t(()=>[ca,a(ue,{modelValue:m.value,"onUpdate:modelValue":$[0]||($[0]=_=>m.value=_),outlined:"",label:"Название"},null,8,["modelValue"])]),_:1}),a(He,{align:"center"},{default:t(()=>[a(F,{color:"primary",loading:u(d),onClick:u(g)},{default:t(()=>[x("Создать")]),_:1},8,["loading","onClick"])]),_:1})]),_:1}))}});const va=G(da,[["__scopeId","data-v-a70283c5"]]),ma={class:"container"},_a=R({__name:"Messanger",setup(e){W();const n=ee(),s=k(!1),o=pt($e);J(()=>n.currentChat.type,(g,d)=>{switch(g){case"dialog":o.value=$e;break;case"group":o.value=ua;break}});function m(){s.value=!s.value}return(g,d)=>(v(),S(wt,{onOpenCreateGroup:m},{default:t(()=>[Q("div",ma,[a(Me,{modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=l=>s.value=l)},{default:t(()=>[a(va,{onClose:m})]),_:1},8,["modelValue"]),a(Vt,{"current-chat-id":u(n).currentChatId,chats:u(n).chatsList,class:H(u(n).currentChatId?"hide":"not_hide")},null,8,["current-chat-id","chats","class"]),u(n).currentChatId?(v(),S(Te(u(o)),{key:1,"current-chat-id":u(n).currentChatId,"current-chat":u(n).currentChat,class:H(u(n).currentChatId?"not_hide":"hide")},null,8,["current-chat-id","current-chat","class"])):(v(),L("div",{key:0,class:H(["dialog_not_selected",u(n).currentChatId?"not_hide":"hide"])},"Выберите, кому вы бы хотели написать",2))])]),_:1}))}});const Ha=G(_a,[["__scopeId","data-v-41f474d9"]]);export{Ha as default};
